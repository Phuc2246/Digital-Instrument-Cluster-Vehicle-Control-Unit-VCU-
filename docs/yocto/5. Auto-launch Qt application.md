# Auto-launch Qt Application on Boot (EGLFS – Raspberry Pi 4)

This document explains how to make your **Qt Quick application** start automatically on boot using **systemd**, running directly with **EGLFS** (without Weston or Wayland).

---

## 1. Create the Recipe Directory

Inside your custom layer (e.g., `meta-myproj`), create the recipe structure:

```bash
mkdir -p meta-myproj/recipes-apps/project1/files
````

Copy all your Qt source files and service file into the `files/` directory.

---

## 2. Create the Recipe File: `project1.bb`

```bitbake
SUMMARY = "Qt Quick Instrument Cluster Application"
DESCRIPTION = "A Qt Quick application for an instrument cluster running on EGLFS"
LICENSE = "CLOSED"

SRC_URI = " \
    file://main.cpp \
    file://main.qml \
    file://qml.qrc \
    file://project1.pro \
    file://Images.qrc \
    file://Fonts.qrc \
    file://Configs.qrc \
    file://communication/canhandler.cpp \
    file://communication/canhandler.h \
    file://fonts/Aldrich-Regular.ttf \
    file://images/background.png \
    file://images/centre.png \
    file://images/arrow.png \
    file://images/high_beam.png \
    file://images/low_beam.png \
    file://images/parking_lights.png \
    file://images/hazard.png \
    file://images/left_arrow.png \
    file://images/right_arrow.png \
    file://io_configs/io_config.json \
    file://project1.service \
"

S = "${WORKDIR}"
B = "${WORKDIR}/build"

DEPENDS += "qtbase qtdeclarative qtquickcontrols2 qtgraphicaleffects"

inherit qmake5 systemd

FILES:${PN} += "${bindir}/project1"
FILES:${PN} += "${systemd_system_unitdir}/project1.service"

SYSTEMD_SERVICE:${PN} = "project1.service"
SYSTEMD_AUTO_ENABLE = "enable"

do_install() {
    # Install the Qt binary
    install -d ${D}${bindir}
    install -m 0755 ${B}/project1 ${D}${bindir}/

    # Install the systemd unit file
    install -d ${D}${systemd_system_unitdir}
    install -m 0644 ${WORKDIR}/project1.service ${D}${systemd_system_unitdir}
}
```

---

## 3. Create the Systemd Service File: `project1.service`

Save this under `meta-myproj/recipes-apps/project1/files/project1.service`

```ini
[Unit]
Description=Qt Instrument Cluster Application
After=multi-user.target

[Service]
Environment=QT_QPA_PLATFORM=eglfs
ExecStart=/usr/bin/project1
Restart=always
User=root
WorkingDirectory=/usr/bin

[Install]
WantedBy=multi-user.target
```

> ✅ **Note:**
>
> * `QT_QPA_PLATFORM=eglfs` ensures Qt runs directly on the framebuffer without Weston.
> * The service automatically restarts if it crashes.
> * Runs under root for simplicity (typical on embedded targets).

---

## 4. Add to `local.conf`

To include your app in the image:

```bash
IMAGE_INSTALL:append = " project1"
```

---

## 5. Build the Image

```bash
bitbake core-image-base
```

After the build completes, flash the image to your SD card and boot the Raspberry Pi 4.

---

## 6. Verify Auto-launch on Boot

After boot, your Qt application should automatically start.
You can check its service status:

```bash
systemctl status project1
```

To manually restart or stop it:

```bash
systemctl restart project1
systemctl stop project1
```

---

## 7. Logs and Debugging

To see application logs:

```bash
journalctl -u project1 -e
```

---

✅ **Result:**
Your **Qt Instrument Cluster** app launches automatically on boot under **EGLFS**, providing a fullscreen UI directly rendered to the display — ideal for embedded dashboard systems.

```

---

